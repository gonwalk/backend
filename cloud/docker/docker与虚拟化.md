# 1.虚拟化技术

## 1.1 虚拟机与虚拟化技术

虚拟机，就是在操作系统里面，装一个软件，然后通过这个软件，再模拟一台甚至多台“子电脑系统”出来。

虚拟机属于虚拟化技术，像Docker这样的容器技术，也是虚拟化技术，但是属于轻量级的虚拟化。

虚拟机虽然可以隔离出很多“子电脑”，但占用空间更大，启动更慢，虚拟机软件可能还要花钱（例如VMWare）。

而容器技术恰好没有这些缺点。它不需要虚拟出整个操作系统，只需要虚拟一个小规模的环境，这一点类似于“沙箱”。

## 1.2 虚拟机与容器对比

Docker启动时间很快，几秒钟就能完成。而且它对资源的利用率很高，一台主机可以同时运行几千个Docker容器。此外，它占的空间很小，而虚拟机一般要几GB到几十GB的空间，容器只需要MB级甚至KB级。

|特性|虚拟机|容器|
|-|-|-|
|隔离级别|操作系统级|进程级|
|隔离策略|Hypervisor|CGroups|
|系统资源|5 ~ 15%| 0 ~ 5%|
|启动时间|分钟级|秒级|
|镜像存储|GB ~ TB| KB ~ MB|
|集群规模|上百| 上万 |
|高可用策略|备份、容灾、迁移|弹性、负载、动态|

## 1.3 Docker与容器关系

注意：Docker本身并不是容器，它是创建容器的工具，是应用容器的引擎。

通过Docker的两句口号，可以更进一步地了解Docker，。
```
第一句：“Build, Ship and Run”，即“搭建、发送、运行”三板斧。

第二句：“Build once，Run anywhere”，即“搭建一次，到处能用”。
```

# 2.Docker技术

## 2.1 Docker技术三大概念

Docker技术中，有三个核心概念，分别是：
```
镜像（Image）

容器（Container）

仓库（Repository）
```

Imagine(镜像)和container（容器）：简单的可以把镜像理解为写好的c程序源代码，容器理解为运行起来的c程序

Repository（仓库）：可以理解为一个代码仓库，像github，大家都可以从上面下载代码，只不过这里是镜像仓库。

比如，我来到一片空地，想建个房子，于是我搬石头、砍木头、画图纸，一顿操作，终于把这个房子盖好了。

结果，我住了一段时间，想搬到另一片空地去。这时候，按以往的办法，我只能再次搬石头、砍木头、画图纸、盖房子。

但是，跑来一个老巫婆，教会我一种魔法。这种魔法，可以把我盖好的房子复制一份，做成“镜像”，放在我的背包里。等我到了另一片空地，就用这个“镜像”，复制一套房子，摆在那边，拎包入住。

在上面的例子里面，那个放在包里的“镜像”，就是Docker镜像。而我的背包，就是Docker仓库。我在空地上，用魔法造好的房子，就是一个Docker容器。


简单地说，Docker镜像是一个特殊的文件系统。它除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的配置参数（例如环境变量）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。

也就是说，每次变出房子，房子是一样的，但生活用品之类的，都是不管的。谁住谁负责添置。

## 2.2 几个重要组件及功能

### 2.2.1 Namespace：（隔离系统资源）

当 Docker 创建一个容器时，它会创建新的六种 namespace 的实例（包括网络资源，进程间通信(IPC)等），然后把容器中的所有进程放到这些 namespace 之中，使得Docker容器中的进程只能看到隔离的系统资源。

### 2.2.2 Cgroup

Cgroup的主要作用有：

• 资源限制：限制任务使用的资源总额

• 优先级分配：通过CPU时间片与磁盘IO大小，控制任务执行优先级

• 资源统计: 统计资源使用量

• 任务控制：对任务执行挂起、恢复等操作

### 2.2.3 Daemon功能

Docker Daemon（守护进程）是Docker架构中一个常驻在后台的系统进程。所谓的“运行Docker”，即代表运行Docker Daemon。总之，Docker Daemon的作用主要有以下两方面：
```
1. 接收并处理Docker Client发送的请求。

2. 管理所有的Docker容器。
```

Daemon接收请求时的具体过程：
```
Docker Daemon运行时，会在后台启动一个Server（进程），Server负责接收Docker Client发送的请求；
接收请求后，Server通过路由与分发调度，找到相应的Handler来处理请求。
```
启动Docker Daemon所使用的可执行文件同样是docker，与Docker Client启动所使用的可执行文件docker相同。既然Docker Client与Docker Daemon都可以通过docker二进制文件创建，那么如何辨别两者就变得非常重要。实际上，执行docker命令时，通过传入的参数可以辨别Docker Daemon与Docker Client，如docker –d代表Docker Daemon的启动，docker ps则代表创建Docker Client，并发送ps请求。

# 3.参考

docker与k8s核心概念学习笔记：https://zhuanlan.zhihu.com/p/54861341

干货满满！10分钟看懂Docker和K8S：https://my.oschina.net/jamesview/blog/2994112